<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>เข้าสู่ระบบ - ระบบรายงานฐานข้อมูลแปลงฟื้นฟูพื้นที่อนุรักษ์</title>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;700&display=swap" rel="stylesheet">
    
    <style>
        body { 
            font-family: 'Kanit', sans-serif; 
            background-image: url('images/bg.jpg'); 
            background-size: cover;
            background-position: center;
            display: flex; 
            justify-content: center; 
            align-items: center; 
            height: 100vh; 
            margin: 0; 
        }

        /* ฉากหลังสีดำจางๆ */
        body::before {
            content: "";
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.4); 
            z-index: -1;
        }

        .login-card { 
            background: rgba(255, 255, 255, 0.95); 
            padding: 2.5rem; 
            border-radius: 15px; 
            box-shadow: 0 10px 25px rgba(0,0,0,0.2); 
            width: 100%; 
            max-width: 400px; /* ขยายกล่องอีกนิดจะได้ไม่อึดอัด */
            text-align: center; 
        }

        /* ✅ จัดโลโก้: ให้อยู่กึ่งกลางและขนาดกำลังดี */
        .logo {
            width: 240px;      /* ขนาด 150px กำลังสวย (240px ใหญ่ไปครับ) */
            height: auto;
            margin-bottom: 15px;
            display: block;
            margin-left: auto;
            margin-right: auto;
        }

        /* ✅ จัดหัวข้อ: ตัวหนา สีเขียวเข้ม */
        .login-card h2 { 
            font-family: 'Kanit', sans-serif;
            font-weight: 700;        /* ตัวหนา */
            font-size: 24px;         
            line-height: 1.5;
            margin-bottom: 20px;
            color: #006400;          /* สีเขียวเข้ม */
            text-shadow: none;       /* ไม่มีเงา (คมชัด) */
        }

        /* ตัวหนังสือบรรทัดล่าง (ในวงเล็บ) */
        .sub-text {
            display: block; 
            margin-top: 5px; 
            font-size: 16px; 
            color: #555;             /* สีเทาเข้ม */
            font-weight: normal;
        }

        input { 
            width: 100%; 
            padding: 14px; 
            margin: 8px 0; 
            border: 1px solid #ddd; 
            border-radius: 8px; 
            box-sizing: border-box; 
            font-size: 16px;
            font-family: 'Kanit', sans-serif;
        }

        button { 
            width: 100%; 
            padding: 14px; 
            background-color: #006400; 
            color: white; 
            border: none; 
            border-radius: 8px; 
            cursor: pointer; 
            font-size: 18px; 
            font-weight: bold; 
            margin-top: 15px; 
            transition: 0.3s;
            font-family: 'Kanit', sans-serif;
        }

        button:hover { 
            background-color: #004d00; 
        }

        .error { color: #d9534f; margin-top: 10px; display: none; font-weight: bold;}
    </style>
</head>
<body>

    <div class="login-card">
        <img src="images/logo.png" class="logo">
        
        <h2>
            ระบบรายงานฐานข้อมูล<br>
            แปลงฟื้นฟูพื้นที่อนุรักษ์
            <span class="sub-text">(ส่วนฟื้นฟูพื้นที่อนุรักษ์)</span>
        </h2>
        
        <form id="loginForm">
            <input type="text" id="username" placeholder="ชื่อผู้ใช้งาน" required>
            <input type="password" id="password" placeholder="รหัสผ่าน" required>
            <button type="submit">เข้าสู่ระบบ</button>
            <p class="error" id="errorMessage">ชื่อผู้ใช้หรือรหัสผ่านผิด!</p>
        </form>
    </div>

    <script>
        document.getElementById('loginForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            const errorMsg = document.getElementById('errorMessage');

            try {
                const response = await fetch('/api/login', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ username, password })
                });
                const result = await response.json();

                if (result.success) {
                    localStorage.setItem('user_data', JSON.stringify(result.user));
                    
                    if (result.user.region_type === 'regional' && result.user.role === 'user') {
                        window.location.href = 'upload.html'; 
                    } else {
                        window.location.href = 'index.html'; 
                    }
                } else {
                    errorMsg.style.display = 'block';
                }
            } catch (err) {
                console.error(err);
                alert('เชื่อมต่อ Server ไม่ได้');
            }
        });
    </script>
</body>
</html>